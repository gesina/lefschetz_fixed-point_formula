\documentclass[english]{scrartcl}
\usepackage{fontspec}
\usepackage{babel}
\usepackage[backend=biber]{biblatex}
\bibliography{lefschetz_formula.bib}
\usepackage{scrlayer-scrpage}
\usepackage{mathtools, amssymb, amsthm, dsfont}
\usepackage{enumitem}
\setlist[description]{font=\normalfont\bfseries}
\setlist[enumerate]{label=(\arabic*)}
\usepackage{tikz-cd}

\usepackage{hyperref}
\hypersetup{
  pdfauthor=Gesina Schwalbe,
  pdftitle=Lefschetz fixed-point formula
}

% THEOREMS
\theoremstyle{definition}
\newtheorem{Def}{Definition}[section]
\newtheorem{DefLem}[Def]{Definition/Lemma}
\newtheorem{Prop}[Def]{Proposition}
\newtheorem{Thm}[Def]{Theorem}
\newtheorem{Lem}[Def]{Lemma}
\newtheorem{Cor}[Def]{Corollary}
\theoremstyle{remark}
\newtheorem{Rem}[Def]{Remark}
\newtheorem{Rev}[Def]{Reminder}
\newtheorem{Ex}[Def]{Example}

% SHORTENINGS
\newcommand*{\N}{\mathds{N}}
\newcommand*{\Z}{\mathds{Z}}
\newcommand*{\Q}{\mathds{Q}}
\newcommand*{\R}{\mathds{R}}
\newcommand*{\C}{\mathds{C}}
\newcommand*{\fF}{\mathds{F}} % finite field
\newcommand*{\Zmod}[1]{\Z/#1} % Z/nZ
\newcommand*{\Zl}{\Z_l} % l-adic completion of Z
\newcommand*{\Ql}{\Q_l} % quotient field of \Zl
\newcommand*{\F}{\mathcal{F}} % sheaf F
\newcommand*{\G}{\mathcal{G}} % sheaf G
\DeclareMathOperator{\Char}{char} % characteristic of a field
\DeclareMathOperator{\codim}{codim} % codimension
\DeclareMathOperator*{\dirlim}{dirlim} % direct limit
\newcommand*{\End}[1]{\text{End}(#1)} % Endomorphisms
\DeclareMathOperator{\Ext}{Ext} % Ext functor
\DeclareMathOperator{\Tor}{Tor} % Tor functor
\DeclareMathOperator{\Hom}{Hom} % Hom functor
\newcommand*{\id}{\text{id}} % identity
\DeclareMathOperator{\Sh}{Sh} % sheaves over a space
\newcommand*{\idest}{i.e.\ }
\newcommand*{\forexample}{e.g.\ }
\newcommand*{\argreplacement}{\,\cdot\,} % argument replacement for functors/functions

\newcommand*{\M}{\Lambda}
% \M_l(r)(R) = {
% for r=0 \ZlZ;
% for r>0 \mu_l(R)^{\otimes r};
% for r<0 Hom_{\Zmod{l}}(\mu_l(R)^{\otimes -r}, \Zmod{l}) }
\newcommand*{\Tr}{\text{tr}} % trace isomorphism
\newcommand*{\tr}[1]{\Tr\left(#1\right)} % trace isomorphism
\newcommand*{\intProd}[2]{{#1\cdot#2}} % intersec. product in the Chow ring
\newcommand*{\intNum}[1]{{\left\langle{#1}\right\rangle}} % intersection number (= tr(intersection product))
\newcommand*{\Graph}[1]{{\Gamma_{#1}}} % graph of a map
\newcommand*{\Diag}[1]{{\Delta_{#1}}} % diagonal (both map and subscheme)
\newcommand*{\trace}[2]{{\text{trace}\left(#1 \,\middle|\, #2 \right)}} % trace of map (#1) in vector space (#2)
\DeclareMathOperator{\CH}{CH} % Chow group functor
\DeclareMathOperator{\Div}{Div} % Divisor group
\DeclareMathOperator{\Pic}{Pic} % Picard group
\DeclareMathOperator{\CL}{cl} % cycle class map
\newcommand*{\cl}[2]{{\CL_{#1}\left(#2\right)}} % cycle class map
\newcommand*{\one}[1]{{1_{#1}}}%{H^*(#1)}}
\newcommand*{\dual}[2]{{#1_{#2}^*}} % dual basis vector
\let\altphi\phi
\renewcommand*{\phi}{\varphi}
\newcommand*{\Poincare}{{\text{Poincaré \ref{poincare}}}}
\newcommand*{\Hc}{{H_c}} % cohomology with compact support

\begin{document}
% HEAD/FOOT
\clearpairofpagestyles
\ohead{Universität Regensburg}
\ihead{Gesina Schwalbe}
\cfoot*{\pagemark}

% TITLE
\title{Poincaré Duality and\\
  Lefschetz Fixed-Foint Formula}
\subject{Seminar:
  Deligne's proof of the Weil Conjecture%\\by Federico Binda, Prof. Dr. Moritz Kerz
}
% \subtitle{Lecture Notes}
\author{Gesina Schwalbe}
% \date{}
\maketitle
\tableofcontents

\section{Motivation}
From topology the following theorem is known that relates the fixed
points of a morphism (counted with multiplicity) with homology:
\begin{Thm}[Lefschetz-Hopf]
  Let $X$ be a compact, smooth manifold and
  $\phi\colon X\to X$ a morphism. Then
  \begin{gather*}
    \sum_{x\in\operatorname{Fix}(\phi)} \operatorname{i}(\phi,x)
    =\sum_{r\in\N}(-1)^r \trace{\phi^*}{H_\text{sing}^r(X,\Q)}\;,
  \end{gather*}
  where $\operatorname{Fix}(\phi)$ are the fixed points of $\phi$ and
  $\mathrm i(\phi,x)$ is the multiplicity of a fixed point $x$ of $\phi$
  in $X$.
\end{Thm}
The proof uses the Poincaré duality theorem which says
\begin{Thm}[Poincaré]
  For a smooth manifold $X$ and $r\in\Z$ holds
  \begin{gather*}
    H_{c\text{,sing}}^r(X,\Z) \cong H_{\dim(X)-r}^{\text{sing}}(X,\Z)
  \end{gather*}
  where $H_{c\text{,sing}}^r(X,\Z)\coloneqq
  \dirlim_{Z\subset X \text{cpt.}}H_{Z,\text{sing}}^r(X,\Z)$
  is cohomology with compact support for $X$.
  Here, $H_{Z,\text{sing}}^r(X,\Z)$ is the $r$th relative
  $\Z$-cohomology of the pair $(X,X\setminus Z)$.
\end{Thm}
The aim of this lecture is to introduce and proof an analogue
statement of the Lefschetz formula for schemes instead of topological
spaces, as well as to give an overview of the necessary preliminaries.
Some convenient correspondences are
\begin{itemize}
\item an algebraically closed field $k$ instead of $\R$ as ground field,
\item $k$-\emph{variety}
  (\idest separated, geometrically reduced scheme of finite type over $k$)
  instead of \emph{$\R$-manifold},
\item \emph{complete} instead of \emph{compact},
\item \emph{non-singular} instead of \emph{smooth},
\item \emph{morphism of varieties} instead of \emph{morphism of manifolds},
\item \emph{étale cohomology} instead of \emph{singular homology}
  (mind that they coincide for non-singular varieties over $\C$ and
  finite coefficient group \cite[see][Thm.~21.1]{milne}),
\item \emph{constant sheaf with value $G$}
  as coefficients instead of an abelian group $G$
  (written $G\in\Sh(X)$ where
  $\Sh(X)$ are the sheaves of abelian groups over $X$)
\item intersection number $\intNum{\intProd{\Graph{\phi}}{\Diag{X}}}$
  (also counting fixed points of $\phi$ with multiplicity)
  instead of $\sum_{x\in\operatorname{Fix}(\phi)}\mathrm{i}(\phi,\cdot)$.
\end{itemize}
We also need to consider modified coefficients since étale cohomology
does not behave well for constant coefficient sheaves of non-finite
abelian groups. However, passing to limits we can consider for $X$
(étale) scheme the étale cohomology with coefficients in $\Ql$ as follows
\begin{gather*}
  H^r(X,\Ql)\coloneqq
  \left(\lim_{n\to\infty}H^r(X,\Zmod{l^n})\right)\otimes_{\Zl}\Ql
\end{gather*}
Thus the final statement of the Lefschetz fixed point formula shall be
\begin{Thm}[Lefschetz]\label{lefschetzthm:motivation}
  Let $k$ be an algebraically closed field, $X$ a non-singular,
  complete $k$-variety, and let $\phi\colon X\to X$ be an
  endomorphism. Then
  \begin{gather*}
    \intNum{\intProd{\Graph{\phi}}{\Diag{X}}}
    = \sum_{r\in\N}(-1)^r\trace{\phi^*}{H^r(X,\Ql)}
  \end{gather*}
\end{Thm}

We instantly get the following two applications:
\begin{description}
\item[Zeta function] For
  $k=\fF_{q}$ a finite field ($q\in\N$),
  $X$ a non-singular variety over $k$ and
  $\phi=F^n$ the $n$th Frobenius homomorphism
  we get
  \begin{gather*}
    \#X(\fF_{q^n}) = \intNum{\intProd{\Graph\phi}{\Diag X}}
  \end{gather*}
  which is essential to further investigate the Zeta function of $X$.
\item[Euler characteristic] Taking $k$ and $X$ as in the Theorem and
  $\phi=\Delta$ we see that the étale Euler characteristic of $X$ is
  just its self-intersection number, \idest
  \begin{gather*}
    \intNum{\intProd{\Delta}{\Delta}} = \chi_{\text{ét}}(X)
  \end{gather*}
\end{description}

For the proof of \ref{lefschetzthm:motivation}
some further nice properties of étale cohomology for
(nice) varieties will be needed, such as:
a Künneth isomorphism (in \autoref{kuennethiso}),
a cycle class map that gives a connection to the Chow ring and
intersection product (in \autoref{def:cycleclassmap}),
Poincaré duality with a trace map (in \autoref{poincare}),
as well as pushforwards on cohomology (in \autoref{def:pushforward}).
To establish these, one needs for étale cohomology the notion of
cohomology with compact support (in \autoref{def:cptcohomology}),
relative cohomology (in \autoref{def:relcoh}),
long exact sequences of (compact) pairs (in \autoref{lesrelcoh}),
Gysin sequences (in \autoref{gysiniso}),
and most of all a cup product, \idest a graded ring structure
(in \autoref{def:cupproduct}).
All of this will be introduced in the following.

\section{Preliminaries on étale Cohomology}
It will be assumed the reader knows about the definition and basic
properties of étale cohomology. If not stated otherwise, for a
(Zariski) scheme $X$ and a (Zariski) sheaf of modules $\F$ over $X$ we
denote with $H^r(X,\F)$ the $r$th étale cohomology group of the étale
sheaf $\F$ over the étale scheme of $X$
\cite[compare][Chap.~6, Examples of Sheaves on $X_\text{ét}$]{milne}.

Also recall that for $\F$ torsion sheaf or $X$ complete these groups
are finite \cite[\forexample][Thm.~19.1]{milne}.

\subsection{Étale Cohomology with compact support}
In this section let $k$ be an algebraically closed field,
$U$ a variety over $k$,
and $\F$ be a torsion sheaf over $U$.

The definition of cohomology with compact support as
$\left(\dirlim_{Z\subset X \text{cpt.}}H_Z^r(X,\Z)\right)$
cannot be copied from topology but has to be adjusted.
However, we will see later (namely \autoref{def:etapoint}),
that at least in degree 0 the following definition
and the expression above coincide.

First recall the following
\begin{Rev}[Nagata compactification]\label{nagata}
  There always exists a complete $k$-variety $X$ and an open, dense
  immersion $j\colon U\to X$. $j$ is also called a
  \emph{compactification} of $U$.
\end{Rev}
\begin{Rev}[Extension by zero]\label{def:extbyzero}
  For an open immersion $j\colon U\to X$ into
  a scheme $X$, $j_!$ (called the \emph{extension by zero} of $j$)
  is defined as
  \begin{gather*}
    j_!\colon \Sh(U)\to \Sh(X)\;,\qquad
    j_!\F \coloneqq \text{sheafification of}\quad
    V\mapsto\begin{cases}
      \F(V) & V\subset U\\
      0     & \text{else}
    \end{cases}
  \end{gather*}
\end{Rev}

\begin{DefLem}\label{def:cptcohomology}
  Let $j\colon U\to X$ be a compactification of $U$. Then the
  cohomology with compact support in degree $r\in\Z$ is defined as
  \begin{gather*}
    \Hc^r(U,\F) \coloneqq H^r(X,j_!(\F))
  \end{gather*}
  This definition is independent of the choice of compactification.
  \begin{proof}[proof (scetch)]
    The set of compactifications of $U$ is partially ordered by proper
    morphisms:
    For two compactifications $j_1\colon U\to X_1$,
    $j_2\colon U\to X_2$ the closure
    $X\coloneqq\overline{(j_1,j_2)(U)}$ in $X_1\times_X X_2$ is again
    a compactification and the projections on $X_1$, $X_2$ are proper.
    Thus one only needs to check $\Hc^r(X,j_!\F)\cong\Hc^r(X',j_!'\F)$
    for compactifications $j$, $j'$ and a proper map $\pi$ such that
    the following diagramm commutes
    \begin{center}
      \begin{tikzcd}
        U\arrow[r,"j"]\arrow[dr,"j'"{left}, bend right=20]
        & X\arrow[d,"\pi"]\\
        & X'
      \end{tikzcd}
    \end{center}
    This then can be shown using a version of the Leray spectral
    sequence and the proper base change theorem.
  \end{proof}
\end{DefLem}

\begin{Rem}
  Note that this is no derived functor!
  However, since $j_!$ is exact for a compactification $j$ of $U$, we
  still get a long exact sequence of cohomology out of a short exact
  sequence of a short exact sequence of sheaves on $U$
  (just use the definition and the long exact sequence of cohomology for
  $H^*(X,\cdot)$).
\end{Rem}

\subsection{Ext-Pairings, Cup Product and Künneth formula}
Again let $k$ be an algebraically closed field throughout the
section.

The foundation of all further investigations will be the graded
ring structure on the sum of the cohomology groups in all degrees
(with appropriate coefficients). The product will be a cup product
denoted $\cup$ to which we here give an approach via pairings of
Ext-groups. 
However, there are concrete descriptions using Čech-cohomology
\cite[see][Chap.~10 and Chap.~22, Cup-products]{milne}
or using the Künneth isomorphism defined later on (see
\autoref{kuennethiso}, \autoref{rem:cupwithkuennethiso}).

\begin{Rem}[Yoneda product]\label{yonedaproduct}
  For an abelian category $\mathcal{A}$ with enough injectives and
  any objects $A,B,C$ of $\mathcal{A}$, $r,s\in\N$ there exists a pairing
  \begin{align*}
    \Ext^r(A,B)\otimes\Ext^s(B,C) &\overset{\cup}{\longrightarrow}
                                    \Ext^{r+s}(A,C)
                                    % \intertext{which is induced by}
    \\
    \text{induced by}\qquad
    \Hom(A,B)\otimes\Hom(B,C) &\longrightarrow \Hom(A,C)\;,\quad
                                f\otimes g\mapsto f\circ g
  \end{align*}
  \begin{proof}[idea for construction]
    The elements of an $r$th Ext-group can be described as extensions
    (\idest sequences) of length $r$.
    Define $\cup$ to be the concatenation of two such sequences. 
  \end{proof}
\end{Rem}

\begin{Prop}[Cup product]\label{def:cupproduct}
  For a $k$-variety $X$, and $\F,\G\in\Sh(X)$ get for all $r,s\in\Z$
  natural pairings
  \begin{gather*}
    H^r(X,\G)\otimes H^r(X,\F) \overset{\cup}\longrightarrow
    H^{r+s}(X,\F\otimes\G)
  \end{gather*}
  This is associative as well as graded commutative, \idest $x\cup y =
  (-1)^{rs}y\cup x$ for $x\in H^r(X,\F)$, $y\in H^s(X,\G$
  \cite[][Rem. 1.18]{milnebook}.
  \begin{proof}[idea for construction]
    The cup product is the map making the following diagram commute
    where the lower row is the \nameref{yonedaproduct}
    \begin{center}
      \begin{tikzcd}[column sep=tiny]
        H^r(X,\F) \arrow[r, phantom, "\otimes"{description}] \arrow[d, equals]&
        H^r(X,\G) \arrow[r] \arrow[d]
        & H^{r+s}(X,\F\otimes\G) \arrow[d,equals]\\
        \Ext_X^r(\mathcal O_X,\F) \arrow[r, phantom, "\otimes"{description}]&
        \Ext_X^s(\F,\F\otimes\G) \arrow[r]
        & \Ext_X^{r+s}(\mathcal O_X,\F\otimes\G)
      \end{tikzcd}
    \end{center}
    This already implies associativity (compare the construction of the
    Yoneda product in \ref{yonedaproduct}).
    
    There is also a more general approach to define cup products for
    derived functors. This states, that for any right exact functor
    $\Gamma\colon \Sh(X)\to\text{AbGrp}$ fulfilling certain nice
    properties, a bifunctor
    $\Gamma(\F)\otimes\Gamma(\G)\to\Gamma(\F\otimes\G)$
    extends to a cup product pairing
    \begin{gather*}
      \operatorname{R}^r\Gamma(\F)\otimes
      \operatorname{R}^s\Gamma(\G) \to
      \operatorname{R}^{r+s}\Gamma(\F\otimes\G)
    \end{gather*}
    \cite[see][Prop. V.1.16]{milnebook}
  \end{proof}
\end{Prop}

We can now proceed with the definition of the graded ring of
cohomology groups by choosing appropriate coefficients.
\begin{Def}\label{def:coefficients}
  Let $X$ be a $k$-variety,
  $n\in\N$ such that $\Char(k)\nmid n$,
  and $r\in\Z$.
  \begin{enumerate}
  \item Let $\Lambda\coloneqq\Lambda_n$ be the constant sheaf of
    $\Zmod{n}$ over $X$.
  \item For an integral domain $R$ let
    $\mu_n(R)\coloneqq\{ u\in R^\times\;|\;u^n=1_R\}$ be the $n$th
    roots of unity in $R$. Define
    \begin{align*}
      \SwapAboveDisplaySkip
      \mu_n(R)^{\otimes r} &\coloneqq \begin{cases}
        \mu_n(R)^{\otimes r} &r>0\\
        \Zmod{n} &r=0\\
        \Hom_{\Zmod{n}}(\mu_n(R)^{\otimes (-r)},\Zmod{n}) &r<0
      \end{cases}
    \end{align*}
    Note that if $R$ contains all $n$th roots of unity, then a
    primitive $n$th root of unity determines isomorphisms
    $\mu_n(R)^{\otimes s}\cong\Zmod{n}$ for all $s\in\Z$.
  \item We define the $r$th twist of $\Lambda$ as
    \begin{gather*}
      \Lambda(r) \coloneqq \text{ sheafification of }\quad
      U\mapsto \mu_n(\Gamma(U,\mathcal O_U)^{\otimes r}
    \end{gather*}
    As explained above, for $k$ algebraically closed $\Lambda(r)$ is
    (non-canonically) isomorphic to $\Lambda$.
    However, choosing a primitive $n$th root of unity determines
    isomorphisms $\Lambda\cong\Lambda(s)$ for all $s\in\Z$ and
    $\Lambda(r)^\vee\coloneqq \Hom_\Lambda(\Lambda(r),\Lambda)
    \cong\Lambda(-r)$.
  \item For an $n$-torsion sheaf over $X$ (\idest a $\Lambda$-module)
    set
    \begin{align*}
      \F(r) &\coloneqq \F\otimes_\Lambda \Lambda(r)\\
      \F(r)^\vee &\coloneqq \Hom_\Lambda(\F,\Lambda(r))\cong \F(-r)
    \end{align*}
  \end{enumerate}
\end{Def}

One may notice an analogue of twisting sheaves in sheaf cohomology,
where $\mathcal O_X$-modules are considered.

With the coefficients defined above we can now state the ring
structure
as follows:
\begin{DefLem}
  For a $k$-variety $X$, and $n\in\Z$ such that $\Char(k)\nmid n$
  define for $r\in\Z$
  \begin{align*}
    H^r(X) \coloneqq H^r(X,\Lambda(r))\;,\qquad
    H^*(X) \coloneqq \bigoplus_{r\in\N}H^r(X)
  \end{align*}
  \begin{enumerate}
  \item $H^*(X)$ together with the cup product as in \ref{def:cupproduct}
    $H^*(X)\otimes H^*(X)\xrightarrow{\cup} H^*(X)$
    is a graded commutative ring
    (follows directly from the properties of the cup product).
  \item The canonical isomorphism $\Zmod{n}\cong H^0(X)$ makes
    $H^*(X)$ an $\Zmod{n}$-Algebra with unit $1_X$,
    which is the image of $1_{\Zmod{n}}$ under the isomorphism.
  \item For any morphism of $k$-varieties $\phi\colon X\to Y$ the
    induced map $\phi^*\colon H^*(Y)\to H^*(X)$ is a homomorphism of
    graded rings
    (follows from the naturality of the cup product).
  \end{enumerate}
\end{DefLem}

A first heavily simplifying observation is the Künneth formula which
produces the cohomology ring of a product out of the cohomology rings
of each factor.

\begin{Thm}[Künneth formula]\label{kuennethiso}
  Let $X$ and $Y$ be $k$-varieties
  ($k$ only needs to be separably closed with $\Char(k)\nmid n$).
  Further let $\F$ and $\G$ be constructible, flat $\Lambda_n$-modules
  over $X$ resp. $Y$.
  Consider the projection maps
  $p\colon X\times_k Y\to X$ and
  $q\colon X\times_k Y\to Y$ and denote
  $\F\boxtimes\G\coloneqq p^*\F\otimes q^*\G$. 
  \begin{enumerate}
  \item   Then for any $m\in\N$ there is an exact sequence
    \begin{center}
      \begin{tikzcd}[row sep=tiny]
        0 \rar
        &\displaystyle\bigoplus_{\mathclap{r+s=m}}H^r(X,\F)\otimes H^s(Y,\G) \rar
        &H^m(X\times_k Y,\F\boxtimes\G) \dar\\
        &&\displaystyle\bigoplus_{\mathclap{r+s=m+1}}\Tor_1^{\Zmod{n}}\left(
          H^r(X,\F), H^s(Y,\G)
        \right) \rar
        &0
      \end{tikzcd}
    \end{center}
    This also holds if one exchanges étale cohomology with étale
    cohomology with compact support.
    The second map is defined by
    \begin{center}
      \begin{tikzcd}[row sep=small]
        \displaystyle\bigoplus_{\mathclap{r+s=m}}
        H^r(X,\F)\otimes H^s(Y,\G)
        \dar&
        \displaystyle\sum_{\mathclap{i}}a_i\otimes b_i
        \arrow[dd,mapsto]\\
        \displaystyle\bigoplus_{\mathclap{r+s=m}}
        H^r(X\times_k Y,q^*\F)\otimes H^s(X\times_k Y,q^*\G)
        \arrow[d,"\cup"]\\
        H^m(X\times_k Y,\F\boxtimes\G)
        &\displaystyle\sum_{\mathclap{i}}p^*a_i \cup q^*b_i
      \end{tikzcd}
    \end{center}
  \item For $X$ and $Y$ complete the above map is an isomorphism. 
  \end{enumerate}
  \begin{proof}Skipped.\end{proof}
\end{Thm}

\begin{Rem}
  For $X$ and $Y$ complete $k$-varieties we obtain a natural
  isomorphism of graded rings, the so-called Künneth isomorphism:
  \begin{align*}
    H^*(X)\otimes H^*(Y) &\rightarrow H^*(X\times_k Y)\\
    a\otimes b &\mapsto p^*(a) \cup q^*(b)
  \end{align*}
  Mind that functoriality makes it compatible with the limit maps
  $\Lambda_{l^{n+1}}(r)\to\Lambda_{l^n}(r)$.
\end{Rem}

\begin{Rem}\label{rem:cupwithkuennethiso}
  The existence of the Künneth isomorphism can also be used for
  a definition of the cup product by identifying $H^*(X\times_k Y)$
  with $H^*(X)\otimes H^*(Y)$. For $x\in H^r(X)$, $y\in H^s(Y)$
  we then define
  \begin{gather*}
    x\cup y \coloneqq (\Diag{X})^*(x\otimes y)
  \end{gather*}
\end{Rem}

\subsection{The Chow Ring and the Cycle Map}
In the statement of the Lefschetz formula the usual intersection
product occurs. The first aim of this section will be to place the
intersection product in a more general setting, more precisely
identify it as the product in the so-called Chow ring. Afterwards we
state the connection between the cohomology and the Chow ring in form
of a natural, graded ring homomorphism.

$k$ is still considered to be an algebraically closed field,
$n\in\Z$ an integer such that $\Char(k)\nmid n$,
and $\Lambda=\Lambda_n$ as above.

\begin{DefLem}
  Let $X$ be a non-singular variety.
  \begin{enumerate}
  \item A \emph{prime cycle} $Z$ of $X$ is an irreducible, closed
    subvariety.
  \item Denote the set of all prime cycles of codimension
    $r\in\N$ in $X$ by $C_p^r(X)$.
    For $r\in\N$ we write
    \begin{gather*}
      C^r(X) \coloneqq \bigoplus_{C_p^r(X)}\Z
    \end{gather*}
    for the free abelian group generated by prime cycles of
    codimension $r$.
    Note: $C^1(X)=\Div(X)$.
  \item The intersection
    $Y\cap Y'\coloneqq (\Diag{X})^*(Y\times_X Y')$ of two cycles 
    $Y\in C^r(X)$, $Y'\in C^s(X)$ is said to be
    \begin{description}[font=\normalfont\itshape]
    \item[proper] if for every irreducible component $Z$ of
      $Y\cap Y'$ holds
      $\codim(Y)+\codim(Y')=\codim(Z)$,
    \item[transversal in a point] if the tangent spaces of
      $Y$ and $Y'$ span the tangent space of $Z$ in this point,
    \item[transversal] if it is so in every point.
    \end{description}
    If $Y$ and $Y'$ intersect properly and transversally we define
    the intersection product of $Y$, $Y'$ as
    \begin{gather*}
      \intProd{Y}{Y'} \coloneqq
      \sum_{\mathclap{
          \substack{Z\subset Y\cap Y'\\
            \text{irred. comp.}
          }}} 1_\Z\cdot Z
    \end{gather*}
  \item The $r$th \emph{Chow group} of $X$ is defined as
    \begin{gather*}
      \CH^r(X) \coloneqq C^r(X)/\sim
    \end{gather*}
    where $\sim$ denotes rational equivalence.
  \item This equivalence  fulfills:
    For any $Y\in C^r(X)$, $Y'\in C^s(X)$ there are
    $\widetilde Y\in C^r(X)$, $\widetilde Y'\in C^s(X)$ intersecting
    properly and transversally with $Y\sim\widetilde Y$ and
    $Y'\sim\widetilde Y'$.
    Thus the intersection product is well defined on equivalence
    classes of the Chow groups and we obtain the \emph{Chow ring}
    \begin{gather*}
      \CH^*(X) \coloneqq \bigoplus_{r\in\N} \CH^r(X)
    \end{gather*}
  \end{enumerate}
\end{DefLem}

As mentioned above, our next goal is a natural homomorphism of graded rings
\begin{gather*}
  \CL_X\colon \CH^*(X)\rightarrow H^*(X)
\end{gather*}
For its definition we first need to introduce another identification
of cohomology groups involving relative cohomology.

\begin{Def}\label{def:relcoh}
  Let $X$ be a $k$-variety and $Z\subset X$ a closed subvariety.
  We define a functor
  \begin{align*}
    \Gamma_Z(X,\argreplacement) \colon \Sh(X) &\rightarrow \text{AbGrp}\\
    \F &\longmapsto \ker\left(\Gamma(X,\F)\to \Gamma(X\setminus S,\F)\right)
  \end{align*}
  For $r\in\Z$ we call the $r$th right derivative of
  $\Gamma_Z(X,\argreplacement)$ the $r$th relative étale cohomology of the pair
  $(X,Z)$ and write
  $H_Z^r(X,\F)\coloneqq\left(\mathrm R^r\Gamma_Z(X,\argreplacement)\right)(\F)$.
\end{Def}
One may compare this with relative singular cohomology $H_Z^r(X,F)=H^r(X,U,F)$
of a pair $(X,U=X\setminus Z)$ of topological spaces with coefficients
in an abelian group $F$. Here one obtains for any pair of topological
spaces a long exact sequence involving relative cohomology.
Even though we are limited to special pairs of varieties for relative
étale topology, it also yields this desirable property:
\begin{Prop}\label{lesrelcoh}
  For a $k$-variety $X$ and a closed subvariety $Z$ of $X$,
  $\F\in\Sh(X)$ there is a long exact sequence of cohomology
  \begin{gather*}
    \dotsc
    \to H_Z^r(X,\F)
    \to H^r(X,\F)
    \to H^r(X\setminus Z,\F)
    \to H_Z^{r+1}(X,\F)
    \to \dotsc
  \end{gather*}
\end{Prop}
There hold even more analogues to the Eilenberg-Steenrod Axioms,
\forexample excision and additivity \cite[compare][Chap.~9]{milne}.

We will further need the following correspondence between compact and
relative cohomology, which yields---inserted into the long exact
sequence from above---an analogue to the Gysin sequence of a of a
vector bundle in topology.
\begin{Thm}[Gysin isomorphism]\label{gysiniso}
  Let $X$ be a non-singular $k$-variety,
  $Z\subset X$ a closed, non-singular subvariety of codimension $c$,
  $r\in\Z$,
  and $\F\in\Sh(X)$ a locally constant $\Zmod{n}$-module.
  Then there is a canonical and natural isomorphism
  \begin{gather*}
    H^{r}\left(Z,\F\right)
    \xrightarrow{\cong}
    H_Z^{r+2c}\left(X,\F(c)\right)
  \end{gather*}
\end{Thm}
Mind that we will need non-singularity in the following to apply this
isomorphism.
\begin{Def}
  For $X,Z,r,\F$ as in \ref{gysiniso} we call the composition
  \begin{gather*}
    H^r(Z,\Lambda)
    \xrightarrow[\text{\ref{gysiniso}}]{\cong}
    H_Z^{r+2c}(X,\Lambda(r))
    \xrightarrow[\text{\ref{lesrelcoh}}]{\text{l.e.s.}}
    H^{r+2c}(X,\Lambda(r))
  \end{gather*}
  the \emph{Gysin map} of the pair $(X,Z)$.
\end{Def}

\begin{DefLem}\label{def:cycleclassmap}
  Let $X$ be a non-singular $k$-variety.
  Then there exists a unique, natural (in both space and coefficients)
  homomorphism of graded rings doubling degree
  \begin{gather*}
    \CL_X\colon \CH^*(X)\rightarrow H^{2*}(X)\coloneqq
    \bigoplus_{c\in\N} H^{2c}(X,\Lambda(c))
  \end{gather*}
  that fulfills
  \begin{enumerate}
  \item In degree~1 it is the map
    \begin{gather*}
      \CL_X^1\colon
      \CH^1(X)\cong \Pic(X)\cong H^1(X,\mathds G_m)
      \xrightarrow{\footnotesize\substack{\text{Kummer}\\\text{sequence}}}
      H^2(X,\mu_n)
      \overset{\text{Def.}}{\underset{\ref{def:coefficients}}{=}}
      H^2(X,\Lambda(1))
    \end{gather*}
  \item For $Z\in\CH^c(X)$ non-singular, $\CL_X^c(Z)$ is the image of
    $1_{\Zmod{n}}$ under the Gysin map
    \begin{gather*}
      \Zmod{n} \cong H^0(Z,\Lambda)
      \xrightarrow[\text{\ref{gysiniso}}]{\cong}
      H_Z^{2c}(X,\Lambda(r))
      \xrightarrow[\text{\ref{lesrelcoh}}]{\text{l.e.s.}}
      H^{2c}(X,\Lambda(r))
    \end{gather*}
  \end{enumerate}
\end{DefLem}

\begin{Ex}\label{ex:clxx}
  As an important case note that for a non-singular variety $X$
  by definition
  \begin{gather*}
    \CL_{X}^0(X)=\one{X}
  \end{gather*}
  since $X$ is the only irreducible
  subvariety of codimension~$0$ and the Gysin map is an isomorphism in
  this case (as $H^0(X\setminus X,\Lambda)=0$ in the long exact Gysin
  sequence).
\end{Ex}

\section{Poincaré Duality}
In this whole section $k$ will be an algebraically closed field,
$n\in\Z$ an integer such that $\Char(k)\nmid n$,
and $\Lambda=\Lambda_n$ as in \ref{def:coefficients}.

Remember that in topology, singular cohomology with compact support is
defined as a limit of relative cohomologies by
$H_{\text{c,sing}}(X,\Z)\coloneqq
\dirlim_{Z\subset X \text{cpt.}}H_{Z,\text{sing}}^r(X,\Z)$.
Unfortunately our definition in \ref{def:cptcohomology} had to differ from
this approach as it does not behave well for étale cohomology.
However, we can still recover the following relation:
\begin{DefLem}\label{def:etapoint}
  Let $X$ be a $k$-variety of dimension $d$ and $Z\subset X$ this time
  a complete subvariety. For any torsion sheaf $\F\in\Sh(X)$ and
  $r\in\Z$ we get canonical maps
  \begin{gather*}
    H_Z^r(X,\F)\xrightarrow{\cong} H_c^r(X,\F)
  \end{gather*}
  In degree~0 this yields an isomorphism
  \begin{gather*}
    \dirlim_{\mathclap{Z\subset X \text{cpt.}}} H_Z^0(X,\F) 
    \xrightarrow{\cong} H_c^0(X,\F)\;.
  \end{gather*}
  For a closed point $P\in X$ we define $\eta_P$ to be the image of
  $1_\Zmod{n}$ under the Gysin map of the pair $(X,\{P\})$
  \begin{gather*}
    \Zmod{n}
    \cong H^0(P,\Lambda)
    \xrightarrow[\text{\ref{gysiniso}}]{\cong}
    H_{\{P\}}^{2d}(X,\Lambda(d))
    \longrightarrow H_c^{2d}(X,\Lambda(d))
  \end{gather*}
\end{DefLem}

Now we can state an analogue to Poincaré duality for étale cohomology:
\begin{Thm}[Poincaré]\label{poincare}
  Let $X$ be a non-singular $k$-variety,
  $d\coloneqq\dim(X)$,
  and let $\F\in\Sh(X)$ be a locally constant constructible
  $\Lambda$-module.
  \begin{enumerate}
  \item There is a unique, natural isomophism,
    called the \emph{trace isomorphism},
    \begin{gather*}
      \Tr_X\colon H_c^{2d}(X,\Lambda(d)) \xrightarrow{\cong} \Zmod{n}
    \end{gather*}
    such that for any closed point $P\in X$ holds
    $\tr{\eta_P}=1_{\Zmod{n}}$.
  \item There are canonical, natural perfect pairings of finite groups
    \begin{gather*}
      H_c^r(X,\F) \otimes H^{2d-r}\left(X,\F^\vee(d)\right)
      \overset\cup\longrightarrow H_c^{2d}(X,\Lambda(d))
      \xrightarrow[\Tr_X]{\cong} \Zmod{n}
    \end{gather*}
  \end{enumerate}
\end{Thm}



% \begin{Cor}
%   We directly obtain the followin consequences
%   \begin{enumerate}
%   \item 
%   \end{enumerate}
% \end{Cor}

\begin{Def}\label{def:pushforward}
  Let $X$ and $Y$ be smooth $k$-varieties, $r\in\Z$,
  $d\coloneqq\dim(X)$, $d'\coloneqq\dim(Y)$, and $c\coloneqq d'-d$.
  For $\pi\colon X\to Y$ proper we obtain a morphism
  \begin{gather*}
    \pi_*\colon
    H^r(X,\Lambda)
    \underset{\ref{poincare}}\cong
    \left(H_c^{2d-r}(X,\Lambda(d))\right)^\vee
    \xrightarrow{(\pi^*)^\vee}
    \left(H_c^{2d-r}(Y,\Lambda(d))\right)^\vee
    \underset{\ref{poincare}}\cong
    H^{r+2c}(Y,\Lambda(c))
  \end{gather*}
\end{Def}

\begin{Rem}\label{proppushforward}
  Let $X,Y,d,d',c,r,\pi$ be as above in \ref{def:pushforward},
  and further let
  $x\in H^r(X,\Lambda)\cong \left(H^{2d-r}(Y,\Lambda(c))\right)^\vee$,
  $y\in H_c^{2d-r}(X,\Lambda)\cong
  \left(H^{r}(X,\Lambda(c))\right)^\vee$.
  Then $\pi_*$ fulfills the following properties:
  \begin{enumerate}[label=(P\arabic*)]
  \item\label{pushforward:altdef}
    $\pi_*$ is uniquely determined by the following commutativity
    \begin{gather*}
      \Tr_{Y}\left(\pi_*(x)\cup y\right) =
      \Tr_{X}\left(x\cup\pi^*(y)\right)
    \end{gather*}
  \item\label{pushforward:composition}
    Taking Pushforward commutes with composition, \idest for two
    proper morphisms of smooth $k$-varieties
    $\pi_1\colon X\to Y$, $\pi_2\colon Y\to Z$ holds
    \begin{gather*}
      (\pi_2\circ \pi_1)_* = (\pi_2)_*\circ(\pi_1)_*\;.
    \end{gather*}
    This is easily verified by checking \ref{pushforward:altdef}:
    \begin{align*}
      \Tr_X((\pi_2)_*(\pi_1)_*(x) \cup y)
      &\overset{\mathclap{\text{\ref{pushforward:altdef}}}}=
        \Tr_X((\pi_1)_*(x) \cup (\pi_2)^*(y))
      \overset{\mathclap{\text{\ref{pushforward:altdef}}}}=
        \Tr_X(x \cup (\pi_1)^*(\pi_2)^*(y))\\
      &=\Tr_X(x \cup (\pi_2\circ\pi_1)_*(y))
      \overset{\mathclap{\text{\ref{pushforward:altdef}}}}=
        \Tr_X((\pi_2\circ\pi_1)_*(x)\cup y)
    \end{align*}
  \item\label{P3}
    If $\pi$ is a closed immersion, then $\pi_*$ is the Gysin map of
    the pair $(X,Y)$. Especially, in degree~0 we have
    \begin{align*}
      \pi_*\colon
      \Zmod{n}\cong H^{0}(X,\Lambda)
      \xrightarrow[\ref{gysiniso}]{\cong}
      H_X^{2c}(Y,\Lambda(c))
      \xrightarrow[\ref{lesrelcoh}]{\text{l.e.s.}}
      H^{2c}(Y,\Lambda(c))
      \;.
    \end{align*}
    Since $X\cong\pi_*X\in\CH^{c}(Y)$, we get by definition of
    the cycle class map in \ref{def:cycleclassmap}
    \begin{gather*}
      \pi_*(\one{X})=\cl{Y}{\pi_*(X)}\in H^{2c}(Y,\Lambda(c))\;.
    \end{gather*}
  \item\label{pushforward:trace}
    If both $X$ and $Y$ are complete one obtains for
    $x\in H^{2d}(X,\Lambda(d))$ the equality
    \begin{gather*}
      \Tr_Y(\pi_*(x))
      = \Tr_Y(\pi_*(x)\cup \one{Y})
      \overset{\ref{pushforward:altdef}}= \Tr_X(x\cup\pi^*(\one{Y}))
      = \Tr_X(x)
      \;.
    \end{gather*}
    Mind that $\pi^*(\one{Y})=\one{X}$. %% MISSING
  \item
    For $X$ and $Y$ complete furthermore holds
    \begin{gather}
      \tag{Projection Formula}\label{pushforward:projectionformula}
      \pi_*(x\cup \pi^*(y)) = \pi_*(x)\cup y
    \end{gather}
    where this time $x\in H^r(X,\Lambda)$ and $y\in H^r(Y,\Lambda)$
    for arbitrary $r,s\in\Z$. This is again easily shown by checking
    \ref{pushforward:altdef}:
    \begin{align*}
      \Tr_X\big((\pi_*(x)\cup y) \cup z\big)
      &\overset{\mathclap{\text{\ref{pushforward:altdef}}}}=
      \Tr_X\big(\pi_*(x)\cup (y \cup z)\big)
      \overset{\mathclap{\text{\ref{pushforward:altdef}}}}=
      \Tr_X\big( x\cup \pi^*(y\cup z)\big)\\
      &\overset{\mathclap{\text{\ref{pushforward:altdef}}}}=
      \Tr_X\big( (x\cup \pi^*(y)) \cup \pi^*(z) \big)
      \overset{\mathclap{\text{\ref{pushforward:altdef}}}}=
      \Tr_X\big( \pi_*(x\cup \pi^*(y)) \cup z\big)
    \end{align*}
  \end{enumerate}
\end{Rem}

\section{Lefschetz Fixed-Point Formula}

\begin{Thm}[Lefschetz fixed-point formula]\label{lefschetzthm}
  Let $X$ be a non-singular, complete variety over an algebraicly
  closed field $k$.
  Let further $\phi\colon X\to X$ be a regular Endomorphism.
  Then
  \begin{gather*}
    \intNum{\intProd{\Graph{\phi}}{\Diag{X}}}
    = \sum_{r\in\N} (-1)^r \trace{\phi^*}{H^r(X,\Ql)}
  \end{gather*}
  where $\trace{\phi^*}{H^r(X,\Ql)}$ is the trace of $\phi^*$ as
  Endomorphism of a $\Ql$-vector space. 
  The sum is finite due to the vanishing
  of cohomology in degree greater than $2\dim(X)$. 
\end{Thm}
Note that $\intNum{\intProd{\Graph{\phi}}{\Diag{X}}}$ is the number of
fixed points of $\phi$, hence the name of this formula.


\begin{Rem}
  In the following we will work with
  $H^*(X)\coloneqq\sum_{r\in\N} H^r(X, \Ql(r))$, where
  \begin{gather*}
    H^r(X) = H^r(X,\Ql(r)) \coloneqq
    \left(\lim_{n\to\infty} H^r(X,\M_{l^n}(r))\right) \otimes \Ql
  \end{gather*}
  All the maps and identities we have seen so far are compatible with
  taking the limit and tensoring with $\Ql$, namely
  cup product,
  trace isomorphism,
  Poincaré duality,
  cycle class map and hence
  pushforward and pullback on cohomology as well as
  the Künneth isomorphism.
  Thus $H^*(X)$ together with the induced cup product is a graded ring
  fulfilling these properties.
  For $X$, $\phi$ as above we will deduce the formula
  \begin{gather*}
    \intNum{\intProd{\Graph{\phi}}{\Diag{X}}}
    = \sum_{r\in\N} (-1)^r \trace{\phi^*}{H^r(X)}
  \end{gather*}
  This already implies the theorem
  (\idest $\trace{\phi^*}{H^r(X)})=\trace{\phi^*}{H^r(X,\Ql)}$),
  because:
  Since $k$ is algebraicly closed---especially it contains all
  roots of unity---we can choose for $r=1$ (hence inductively all
  $r\in\N$) and $n\in\N$ an isomorphism
  \begin{gather*}
    \M_{l^n}(r)\coloneqq\mu_{l^n}^{\otimes_k r} \cong \Zmod{(l^n)}
  \end{gather*}
  So $H^r(X)\cong H^r(X,\Ql)$ as $\Ql$-vector spaces.
  One now has to observe, that the traces of $\phi^*$ commute with
  this isomorphism.
  % TODO!!
\end{Rem} 

\begin{Rev}
  Let $V$ be a finite dimensional $K$-vector space, $(e_i)_{i=1}^n$ a basis,
  and $(\check e_i)_{i=1}^n$ the corresponding dual basis.
  Denote the evaluation by
  \begin{align*}
    \cup\colon V\otimes V^* \to K,\quad
    v\otimes \omega \mapsto v\cup\omega\coloneqq \omega(v)
  \end{align*}
  Then the trace of some $f\in\End{V}$ is defined as
  \begin{gather*}
    \trace{f}{V} \coloneqq \sum_{i=1}^n f(e_i)\cup \check e_i
  \end{gather*}
\end{Rev}

\begin{proof}[proof of \autoref{lefschetzthm}]~
  %\begin{enumerate}[label={Step \arabic*.}]
    %% STEP % [25.3]
    First we need the following identity:
    \begin{Lem}\label{step1}
      For a regular morphism $\phi\colon X\to Y$ of complete varieties
      and $y\in H^*(Y)$ holds
      \begin{gather*}
        p_*\left(\cl{X\times Y}{\Graph{\phi}} \cup q^*(y)\right)
        = \phi^*(y)           
      \end{gather*}
      \begin{proof}
        Since $Y$ is separated, $\Graph{\phi}\colon X\to X\times_k Y$
        is a closed immersion, hence proper, and we can apply the
        \ref{pushforward:projectionformula}.
        Furthermore, by functoriality of the cycle class map we have
        \begin{gather}
          \cl{X\times_k Y}{\Graph{\phi}} \coloneqq
          \cl{X\times_k Y}{(\Graph{\phi})_*(X)} =
          (\Graph{\phi})_*(\cl{X}{X}) \overset{\ref{ex:clxx}}{=} % REF MISSING          
          (\Graph{\phi})_*\left(\one{X}\right)
        \end{gather}
        Altogether we get
        \begin{align*}
          p_*\left(\cl{X\times Y}{\Graph{\phi}} \cup q^*(y)\right)
          &=  p_*\left(
            (\Graph{\phi})_*\left(\one{X}\right) \cup q^*(y)
            \right)\\
          &\overset{\mathllap{\text{\ref{pushforward:projectionformula}}}}{=}
            p_*(\Graph{\phi})_*\left( \one{X} \cup (\Graph{\phi})^*q^*(y) \right)\\
          &\overset{\mathllap{\ref{pushforward:composition}}}=
            (p\circ\Graph{\phi})_* \left(
            \one{X} \cup (q\circ\Graph{\phi})^*(y) \right)\\
          &\overset{\mathllap{\text{Def. $\Graph\phi$}}}=
            \id_* \left( \one{X} \cup \phi^*(y) \right)\\
          &= \phi^*(y)
        \end{align*}
      \end{proof}
    \end{Lem}

    %% STEP
    Now we can explicitly describe
    $\cl{X\times_k X}{\Graph{\phi}}$:
    \begin{Lem}\label{clofgraph}
      Let $X$ be a complete and non-singular variety of dimension $d$
      and $\altphi\in\End{X}$ regular.
      Write $e^{2d}\in H^{2d}(X)$ for the canonical generator
      with $\tr{e^{2d}}=1\in\Ql$.
      Furthermore, let $(b_k)_k$ be a basis of $H^*(X)$ as
      $\Ql$-vector space and $(f_k)_k$ be the dual Basis with respect
      to the cup product, \idest $b_k\cup f_l=\delta_{kl}e^{2d}$
      (exists by \nameref{poincare}).
      Then
      \begin{gather*}
        \cl{X\times_k X}{\Graph{\phi}} =
        \sum_{k}^{2d} \phi^*(b_k)\otimes  f_k
      \end{gather*}
      \begin{proof}
        By the \nameref{kuennethiso} % REF MISSING
        $H^*(X\otimes X) \cong H^*(X)\otimes_{\Ql}H^*(X)$ is a
        $H^*(X)$-module with basis
        $(\one{X}\otimes f_k)_{k}$.
        Therefore, there are unique factors $a_{k}$ in $H^*(X)$ s.t.
        \begin{gather}
          \label{eq:step2}
          \cl{X\times_k Y}{\Graph{\phi}} =
          \sum_{k} a_k\otimes f_k
        \end{gather}
        Explicitly
        \begin{align*}
          a_j
          = p_*(a_j\otimes e^{2d})
          &= p_*\Big(
            \sum_k(a_k\otimes f_k)\cup (\one{X}\otimes b_j)
            \Big)\\
          &\overset{\mathllap{\eqref{eq:step2}}}= p_*\left(
            \cl{X\times_k X}{\Graph{\phi}} \cup q^*(b_j)
            \right)\\
          &\overset{\mathllap{\ref{step1}}}= \phi^*(b_j) 
        \end{align*}
      \end{proof}
    \end{Lem}

    %% STEP
    For all $r\in\{0,\dotsc,2d\}$ let $(e_i^r)_{i}$ be a basis of
    $H^r(X)$ as $\Ql$-vector space. A union of these obviously yields
    a basis of $H^*(X)$ as $\Ql$-vector space, whose Poincaré dual
    basis will be the union of degreewise dual bases
    $(\check e_i^{2d-r})_{i}\subset H^{2d-r}(X)\cong (H^{r}(X))^\vee$,
    \idest
    $e^r_i\cup \check e_j^{2d-s}=\delta_{ij}\delta_{rs}e^{2d}$.
    Applying Lemma~\ref{clofgraph} with bases $(e_i^r)_{i,r}$ and
    $(\check e_i^{2d-r})_{i,r}$ to $\phi$ and $\id$ yields
    \begin{align*}
      \cl{X\times_k X}{\Graph{\phi}}
      &= \sum_{i,r} \phi^*(e_i^r)\otimes \check e_i^{2d-r}\\
      \cl{X\times_k X}{\Diag{X}}
      &= \sum_{i,r} e_i^r\otimes \check e_i^{2d-r} =
        \sum_{i,r} (-1)^{r\cdot (2d-r)}\check e_i^{2d-r}\otimes e_i^{r} =
        \sum_{i,r} (-1)^{r}\check e_i^{2d-r}\otimes e_i^r\\
      \cl{X\times_k X}{\intProd{\Graph{\phi}}{\Diag{X}}}
      &= \cl{X\times_k X}{\Diag{X}} \cup \cl{X\times_k X}{\Graph{\phi}}\\
      &= \sum_{i,r,j,s} (-1)^{r}
        \left(\phi^*(e_i^r)\cup \check e_j^{2d-s}\right)
        \otimes \left(\check e_i^{2d-r}\cup e_j^s\right)\\
      &= \sum_{i,r} (-1)^{r}
        \left(\phi^*(e_i^r)\cup \check e_i^{2d-r}\right)
        \otimes e^{2d}\\
      &\overset{\mathllap{\Poincare}}=
        \sum_{r} (-1)^r \trace{\phi^*}{H^r(X)} e^{2d} \otimes e^{2d}
    \end{align*}
    Altogether, using
    \begin{align*}
      \tr{e^{2d} \otimes e^{2d}}
      = \tr{\Diag{X}_*(e^{2d})}
      \overset{\ref{pushforward:trace}}= \tr{e^{2d}}
      \overset{\text{Def.}}= 1\in\Ql
    \end{align*}
    we get our final result:
    \begin{gather*}
      \intNum{\intProd{\Graph\phi}{\Diag X}} \coloneqq
      \tr{\cl{X\times_kX}{\intProd{\Graph\phi}{\Diag X}}}
      = \sum_{r\in\N} (-1)^r \trace{\phi^*}{H^r(X,\Ql)}
    \end{gather*}
%  \end{enumerate}
\end{proof}

\nocite{*}
\printbibliography
\end{document}
